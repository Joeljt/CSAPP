## 存储器层次结构

### 存储器分类

#### 0. 寄存器（Registers）

1. 硬件结构
   - 基于触发器电路
   - 每位一个触发器
   - 64位寄存器 = 64个触发器

2. 特点
   - CPU 内部集成
   - 速度最快（1 周期）
   - 容量最小（几百字节）
   - 成本最高

#### 1. RAM（随机访问存储器）

1. SRAM（静态）
   - 用触发器存储
   - 特点：速度快，功耗大，成本高，容量小
   - 用途：CPU 缓存（L1/L2/L3 Cache）
   - 不需要刷新

2. DRAM（动态）
   - 用电容存储
   - 特点：速度中等，需要定期刷新，成本低，容量大
   - 用途：主存（Main Memory）
   - 发展：SDRAM → DDR → DDR2 → DDR3 → DDR4 → DDR5
         每代速度翻倍，功耗降低

#### 2. 外部存储

1. HDD（机械硬盘）
   - 基于磁头和磁盘
   - 特点：容量大，成本低，速度慢，机械结构易损坏
   - 访问延迟：寻道时间 + 旋转延迟

2. SSD（固态硬盘）
   - 基于闪存（NAND Flash）
   - 特点：速度快，无机械部件，功耗低，但成本较高
   - 读写速度比 HDD 快 5-10 倍

#### 3. 速度对比（从快到慢）

```
寄存器 > L1 Cache > L2 Cache > L3 Cache > 主存 > SSD > HDD
```

### 局部性原理

整个计算机系统，从硬件到软件，都利用并依赖局部性原理提供好的性能。

1. 时间局部性：最近访问过的数据，将来很可能再次访问；
2. 空间局部性：最近访问过的数据，其附近的数据，将来很可能再次访问；

基于局部性原理，对于频繁访问同一个数据的程序，我们说它具有良好的时间局部性。

如果程序以固定步长访问内存，则步长越短，空间局部性越好，而随机在内存空间中跳跃访问的程序，空间局部性较差。

### 缓存的分类

当 CPU 需要加载某个数据时，会按照存储体系结构依次进行查找，如果能够在缓存中找到则为缓存命中，否则为缓存未命中。

对于缓存未命中来说，分为**强制未命中（cold miss）**和**冲突未命中（conflict miss）**。

其中，强制未命中是设备刚刚启动时，缓存中还没有任何内容，这时访问任何内容都属于强制未命中；等系统正常运行后，所有缓存空间都被占据，就不会再有强制未命中的情况出现。

在缓存体系结构中，上层缓存小于下层缓存，所以每一层能容纳的数据大小是有上限的。

在缓存中，数据是以缓存行的形式存在。以 L1 缓存为例，每一行最多可以存储 64 字节的连续字节数据，会同时存在多个缓存行。

由于缓存空间有限，所以一定会出现不同的地址计算出同一个缓存行的情况，也就是冲突的情况，即冲突未命中。

### 缓存结构

