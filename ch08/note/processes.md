## 进程

操作系统以进程的概念对运行程序提供了两层抽象：

1. 独立控制流，让程序认为自己独占整个 CPU 资源；
2. 独立地址空间，让程序认为自己独占整个内存；

### 逻辑控制流

CPU 会在某个进行执行期间进行控制权的切换，暂停某个进程，去执行其他进程的指令。

这个情况有可能发生在两种情况下：

1. 每个进程在执行的时候有时间记录，如果 CPU 认为执行过久，就会切走；
2. 异步 I/O，在等待磁盘数据写入内存的时候，CPU 可能就会切走给其他进程执行；

### 并发控制流

如果两个程序在执行的时候，执行时间上有重叠，我们就说当前处于并发执行。

如前所述，如果 CPU 认为执行时间过久，就会切走执行其他程序，所以一个程序的完整执行周期是分成一段一段的，又叫时间切片。

并发、多任务、时间切片，实际上都是同一个概念。

但对于多核处理器，在同一时间在多个核心上同时执行的程序，我们叫平行执行，parallel flow 或者 parallel execution。

### 私有地址空间

每个进程的私有地址空间，包含用户空间和内核空间，但内核地址空间是所有进程共享的。

在典型的现代操作系统（如 Linux），每个进程的虚拟地址空间大致分为两个部分：

1. 用户空间（User Space）：进程私有，不能直接访问内核代码和数据，通常从 0x00000000 开始，到 0xC0000000（或 0x40000000，取决于系统架构）
2. 内核空间（Kernel Space）：所有进程共享，通常位于 0xC0000000 及以上，直接映射物理内存。

### 用户态和内核态

系统使用一个 mode 位来区分用户态和内核态，这个切换通过异常控制流来实现，程序无法主动操作。

### 上下文切换

一个进程运行有其特有的运行环境，包括数据、内存布局、变量、程序计数器、寄存器状态、栈状态等等信息，要保证在不同进程间切换又没有副作用，就需要在切换的时候，把每个进程的上下文信息都及时地进行保存、还原，这个过程就是上下文切换。

切换一个进程执行需要三个步骤：

1. 保存当前正在执行的进程的上下文信息；
2. 还原要切换到的进程的上下文；
3. 将控制权交给新切换到的进程；
